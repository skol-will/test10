<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IFL Playoff Predictor</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Noto+Sans&display=swap');
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Noto Sans', sans-serif;
      background: #0e1111;
      color: white;
      margin: 0 auto;
      max-width: 1100px;
      padding: 1rem 1rem 4rem;
    }
    h1, h2, h3 {
      font-family: 'Bebas Neue', cursive;
      text-align: center;
      margin: 0.5rem 0 1rem;
      user-select: none;
    }
    h2 {
      font-size: 2.4rem;
    }
    h3 {
      font-size: 1.7rem;
      margin-bottom: 0.3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.6rem;
    }
    h3 img.div-logo {
      height: 26px;
      width: 26px;
      object-fit: contain;
    }
    .section {
      margin-bottom: 2rem;
    }
    #stage1 {
      user-select: none;
    }
    #stage1 .header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.8rem;
      margin-bottom: 1rem;
    }
    #stage1 .header img {
      height: 48px;
      width: 48px;
      object-fit: contain;
    }
    #stage1 .subtitle {
      font-size: 1.2rem;
      text-align: center;
      font-weight: normal;
      margin-bottom: 2rem;
      color: #ccc;
    }
    .division-section {
      margin-bottom: 2.2rem;
    }
    .team-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
    }
    .team-card {
      width: 144px;
      height: 40px;
      background-color: #1a1a1a;
      position: relative;
      cursor: pointer;
      overflow: hidden;
      transition: transform 0.2s ease, background-color 0.3s ease, border-color 0.3s ease;
      user-select: none;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      padding: 0 8px;
      border-radius: 8px;
      border: 3px solid transparent;
      color: white;
      font-weight: bold;
      font-size: 14px;
      text-align: center;
      box-sizing: border-box;
    }
    .team-card img {
      width: 36px;
      height: 36px;
      object-fit: contain;
      border-radius: 6px;
      user-select: none;
      flex-shrink: 0;
    }
    /* Label is just the text, centered vertically/horizontally by flex */
    .team-card .label {
      flex: 1 1 auto;
      user-select: none;
    }
    .team-card:hover:not(.disabled):not(.selected) {
      transform: scale(1.07);
      background-color: #292929;
    }
    .team-card.selected {
      background-color: #004466;
      border-color: #00bfff;
    }
    .team-card.disabled {
      opacity: 0.35;
      cursor: not-allowed;
    }
    button {
      margin: 3rem auto 0 auto;
      display: block;
      padding: 0.8rem 1.6rem;
      font-size: 1.2rem;
      border-radius: 8px;
      border: none;
      background-color: #007bff;
      color: white;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.25s ease;
    }
    button:disabled {
      background-color: #004466;
      cursor: not-allowed;
    }
    #stage2 {
      display: none;
      user-select: none;
    }
    .bracket {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.5rem;
      margin-top: 2rem;
    }
    .round {
      background: #1a1a1a;
      padding: 1rem;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      user-select: none;
    }
    .round h3 {
      font-family: 'Bebas Neue', cursive;
      margin-bottom: 1rem;
      color: #00bfff;
    }
    .matchup-container {
      width: 160px;
      min-height: 100px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
      background: #222;
      border-radius: 10px;
      padding: 0.5rem 0;
      user-select: none;
    }
    .match-label {
      color: #00bfff;
      font-weight: 700;
      margin-bottom: 6px;
      user-select: none;
    }
    #world-bowl-logo {
      display: block;
      margin: 1.8rem auto 0 auto;
      width: 120px;
      height: 120px;
      object-fit: contain;
    }
    #champion-card {
      margin-top: 1rem;
      /* same style as .team-card so no overrides needed */
    }
    /* Responsive */
    @media (max-width: 480px) {
      body {
        padding: 1rem 0.5rem 3rem;
        max-width: 100%;
      }
      .team-card {
        width: 120px;
        height: 34px;
        font-size: 12px;
      }
      .team-card img {
        width: 32px;
        height: 32px;
      }
      .bracket {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      .round {
        width: 100%;
      }
      .matchup-container {
        width: 100%;
        min-height: auto;
      }
    }
  </style>
</head>
<body>
  <div id="stage1" class="section">
    <div class="header">
      <img src="https://res.cloudinary.com/de4q4iitx/image/upload/v1752231585/ifl-logo_q9fmai.png" alt="IFL Logo" />
      <h1>International Football League Playoff Predictor</h1>
    </div>

    <h2>Division Winners</h2>
    <p class="subtitle">Select 1 division winner from each division</p>
    <div id="division-winners"></div>

    <h2>Wildcards</h2>
    <p class="subtitle">Select 5 wildcard teams</p>
    <div class="team-grid" id="wildcards"></div>

    <button id="toStage2Btn" disabled>Continue to Matchups</button>
  </div>

  <div id="stage2" class="section">
    <h2>Playoff Bracket</h2>
    <div class="bracket" id="bracket">
      <!-- Bracket rounds will be dynamically inserted here -->
    </div>
    <img id="world-bowl-logo" src="https://res.cloudinary.com/de4q4iitx/image/upload/v1752185315/WBIII_id02n2.png" alt="World Bowl Logo" />
    <button id="saveScreenshotBtn">Save Screenshot</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    // Data
    const divisions = {
      "World East": ["Australia Whites", "Italia Bulls", "Belarus Barbarians", "Singapore Smelters", "South Korea Deers", "Poland Panthers"],
      "World Central": ["Germany Cavaliers", "UK 3 Lions", "Finland Frigate", "Belgium Bulldogs", "Holland Hornets", "South Africa Silverbacks"],
      "World West": ["USA Drones", "Jamaica Thunder", "Rwanda Raiders", "Egypt Pharaohs", "Peru Piranhas", "Brazil Hummingbirds"]
    };
    const teamLogos = {
      "Australia Whites": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752182184/australia-whites_h9o2vz.png",
      "Italia Bulls": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752182185/italia-bulls_aocvis.png",
      "Belarus Barbarians": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752182185/belarus-barbarians_ydx3kz.png",
      "Singapore Smelters": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752182186/singapore-smelters_qn3ges.png",
      "South Korea Deers": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752182186/southkorea-deers_jbt02f.png",
      "Poland Panthers": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752182186/poland-panthers_ppg3zr.png",
      "Germany Cavaliers": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752182185/germany-cavaliers_qrcojc.png",
      "UK 3 Lions": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752182186/uk-tri-lions_kyixfr.png",
      "Finland Frigate": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752182185/finland-frigate_u7rjbj.png",
      "Belgium Bulldogs": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752182185/belgium-bulldogs_hrx8td.png",
      "Holland Hornets": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752182185/holland-hornets_ilzroo.png",
      "South Africa Silverbacks": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752182186/southafrica-silverbaks_x6but2.png",
      "USA Drones": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752182187/usa-drones_doeba8.png",
      "Jamaica Thunder": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752182185/jamaica-thunder_ogo7aj.png",
      "Rwanda Raiders": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752182186/rwanda-raiders_aqtgu7.png",
      "Egypt Pharaohs": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752182185/egypt-pharaohs_ycglpl.png",
      "Peru Piranhas": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752182185/peru-piranhas_yueas6.png",
      "Brazil Hummingbirds": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752182185/brazil-hummingbirds_dras9r.png"
    };
    const divisionLogos = {
      "World East": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752231585/world-east_dzwpw9.png",
      "World Central": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752231585/world-central_okus8o.png",
      "World West": "https://res.cloudinary.com/de4q4iitx/image/upload/v1752231585/world-west_ie8gga.png"
    };

    // State
    let selectedDivisionWinners = {};
    let selectedWildcards = new Set();

    // DOM refs
    const divisionWinnersContainer = document.getElementById("division-winners");
    const wildcardsContainer = document.getElementById("wildcards");
    const toStage2Btn = document.getElementById("toStage2Btn");
    const bracketContainer = document.getElementById("bracket");

    // Create team card for stage 1 and 2 and bracket with centered text
    function createTeamCard(team, selectedTeams, onClick, disabled=false) {
      const card = document.createElement("div");
      card.className = "team-card";
      if (disabled) card.classList.add("disabled");
      if (selectedTeams.has(team)) card.classList.add("selected");
      card.innerHTML = `
        <img src="${teamLogos[team]}" alt="${team}" />
        <div class="label">${team}</div>
      `;
      if (!disabled) {
        card.addEventListener("click", () => onClick(team));
      }
      return card;
    }

    // Render division winners (Stage 1)
    function renderDivisionWinners() {
      divisionWinnersContainer.innerHTML = "";
      for (const [divName, teams] of Object.entries(divisions)) {
        const divSection = document.createElement("div");
        divSection.className = "division-section";

        // Title with division logo
        const h3 = document.createElement("h3");
        h3.innerHTML = `
          <img class="div-logo" src="${divisionLogos[divName]}" alt="${divName}" />
          ${divName}
        `;
        divSection.appendChild(h3);

        // Team grid
        const grid = document.createElement("div");
        grid.className = "team-grid";

        teams.forEach(team => {
          const disabled = (selectedWildcards.has(team)) || 
            (selectedDivisionWinners[divName] && selectedDivisionWinners[divName] !== team);
          const card = createTeamCard(team, new Set([team]), () => {
            if(selectedDivisionWinners[divName] === team) {
              delete selectedDivisionWinners[divName];
            } else {
              selectedDivisionWinners[divName] = team;
              selectedWildcards.delete(team);
            }
            updateUIStage1();
          }, disabled);
          grid.appendChild(card);
        });

        divSection.appendChild(grid);
        divisionWinnersContainer.appendChild(divSection);
      }
    }

    // Render wildcards (Stage 1)
    function renderWildcards() {
      wildcardsContainer.innerHTML = "";
      const allDivisionWinners = new Set(Object.values(selectedDivisionWinners));
      for (const teams of Object.values(divisions)) {
        teams.forEach(team => {
          // Disabled if chosen as division winner and not already selected wildcard
          const disabled = allDivisionWinners.has(team) && !selectedWildcards.has(team);
          const selected = selectedWildcards.has(team);
          if (!disabled || selected) {
            const card = createTeamCard(team, selectedWildcards, () => {
              if(selectedWildcards.has(team)) {
                selectedWildcards.delete(team);
              } else if(selectedWildcards.size < 5) {
                selectedWildcards.add(team);
              }
              updateUIStage1();
            }, disabled);
            wildcardsContainer.appendChild(card);
          }
        });
      }
    }

    // Enable continue button only if 3 division winners and 5 wildcards selected
    function updateContinueButton() {
      toStage2Btn.disabled = (Object.keys(selectedDivisionWinners).length !== 3 || selectedWildcards.size !== 5);
    }

    // Update UI Stage 1
    function updateUIStage1() {
      renderDivisionWinners();
      renderWildcards();
      updateContinueButton();
    }

    // Stage 2 bracket variables
    let qfWinners = [null, null, null, null];
    let sfWinners = [null, null];
    let finalWinner = null;

    // Create bracket team card (same style as stage 1/2)
    function createBracketTeamCard(team, selectedTeam, onSelect) {
      const card = document.createElement("div");
      card.className = "team-card";
      if (team === selectedTeam) card.classList.add("selected");
      card.innerHTML = `
        <img src="${teamLogos[team]}" alt="${team}" />
        <div class="label">${team}</div>
      `;
      card.addEventListener("click", () => {
        if (selectedTeam !== team) onSelect(team);
      });
      return card;
    }

    // Create matchup container with "Match X" label and two team cards
    function createMatchup(matchNumber, teams, round, index, selectedTeams, onSelect) {
      const container = document.createElement("div");
      container.className = "matchup-container";

      const label = document.createElement("div");
      label.className = "match-label";
      label.textContent = `Match ${matchNumber}`;
      container.appendChild(label);

      teams.forEach(team => {
        const selectedTeam = selectedTeams[index];
        const card = createBracketTeamCard(team, selectedTeam, teamSelected => {
          selectedTeams[index] = teamSelected;
          // Reset downstream winners if needed
          if(round === "quarterfinals") {
            if(index < 2) sfWinners[0] = null;
            else sfWinners[1] = null;
            finalWinner = null;
          } else if(round === "semifinals") {
            finalWinner = null;
          }
          updateBracket();
        });
        // Disable if another team is selected in this matchup
        if(selectedTeam && selectedTeam !== team) {
          card.classList.add("disabled");
        }
        container.appendChild(card);
      });

      return container;
    }

    // Render bracket rounds and champion card
    function renderBracket(playoffTeams) {
      bracketContainer.innerHTML = "";

      // Quarterfinals
      const quarterfinals = document.createElement("div");
      quarterfinals.className = "round";
      const qTitle = document.createElement("h3");
      qTitle.textContent = "Quarter Finals";
      quarterfinals.appendChild(qTitle);

      playoffTeams.quarterfinals.forEach((teams, i) => {
        const matchup = createMatchup(i + 1, teams, "quarterfinals", i, qfWinners, (team) => {
          qfWinners[i] = team;
          if(i < 2) sfWinners[0] = null;
          else sfWinners[1] = null;
          finalWinner = null;
          updateBracket();
        });
        quarterfinals.appendChild(matchup);
      });
      bracketContainer.appendChild(quarterfinals);

      // Semifinals
      const semifinals = document.createElement("div");
      semifinals.className = "round";
      const sfTitle = document.createElement("h3");
      sfTitle.textContent = "Semi Finals";
      semifinals.appendChild(sfTitle);

      for(let i = 0; i < 2; i++) {
        const teams = [];
        if(i === 0 && qfWinners[0] && qfWinners[1]) {
          teams.push(qfWinners[0], qfWinners[1]);
        } else if(i === 1 && qfWinners[2] && qfWinners[3]) {
          teams.push(qfWinners[2], qfWinners[3]);
        }
        if (sfWinners[i]) teams[0] = sfWinners[i]; // overwrite first team if semifinal winner chosen

        if(teams.length === 2) {
          const matchup = createMatchup(i + 5, teams, "semifinals", i, sfWinners, (team) => {
            sfWinners[i] = team;
            finalWinner = null;
            updateBracket();
          });
          semifinals.appendChild(matchup);
        }
      }
      bracketContainer.appendChild(semifinals);

      // Finals
      const finals = document.createElement("div");
      finals.className = "round";
      const fTitle = document.createElement("h3");
      fTitle.textContent = "Final";
      finals.appendChild(fTitle);

      const finalTeams = [];
      if(sfWinners[0] && sfWinners[1]) {
        finalTeams.push(sfWinners[0], sfWinners[1]);
      }
      if(finalWinner) finalTeams[0] = finalWinner;

      if(finalTeams.length === 2) {
        const finalMatchup = createMatchup(7, finalTeams, "finals", 0, [finalWinner], (team) => {
          finalWinner = team;
          updateChampion();
          updateBracket();
        });
        finals.appendChild(finalMatchup);
      }
      bracketContainer.appendChild(finals);

      // Champion
      const championDiv = document.createElement("div");
      championDiv.className = "round";
      const championTitle = document.createElement("h3");
      championTitle.textContent = "Champion";
      championDiv.appendChild(championTitle);

      const championCard = document.createElement("div");
      championCard.id = "champion-card";
      championCard.className = "team-card";

      if(finalWinner) {
        championCard.innerHTML = `
          <img src="${teamLogos[finalWinner]}" alt="${finalWinner}" />
          <div class="label">${finalWinner}</div>
        `;
        championCard.classList.add("selected");
      } else {
        championCard.textContent = "Select the final winner above";
        championCard.style.color = "#666";
        championCard.style.justifyContent = "center";
      }
      championDiv.appendChild(championCard);
      bracketContainer.appendChild(championDiv);
    }

    // Generate playoff teams from selections
    function generatePlayoffTeams() {
      const divWinners = Object.values(selectedDivisionWinners);
      const wildcardsArr = Array.from(selectedWildcards);
      return {
        quarterfinals: [
          [divWinners[0], wildcardsArr[0]],
          [divWinners[1], wildcardsArr[1]],
          [divWinners[2], wildcardsArr[2]],
          [wildcardsArr[3], wildcardsArr[4]]
        ]
      };
    }

    // Update bracket after selections
    function updateBracket() {
      renderBracket(generatePlayoffTeams());
    }

    // Initialization and event handlers
    function init() {
      renderDivisionWinners();
      renderWildcards();
      updateContinueButton();

      toStage2Btn.addEventListener("click", () => {
        if (!toStage2Btn.disabled) {
          document.getElementById("stage1").style.display = "none";
          document.getElementById("stage2").style.display = "block";
          updateBracket();
        }
      });

      document.getElementById("saveScreenshotBtn").addEventListener("click", () => {
        html2canvas(bracketContainer).then(canvas => {
          const link = document.createElement("a");
          link.download = "ifl-playoff-bracket.png";
          link.href = canvas.toDataURL();
          link.click();
        });
      });
    }

    init();
  </script>
</body>
</html>
